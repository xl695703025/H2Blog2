<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yuxia.blog.mapper.ArticleMapper">
	<select id="selectArticleByUserName" resultType="Article">
		select a.*,u.userNickName,c1.categoryName  childCategory,c2.categoryName parentCategory 
		from article a,user u,category c1 LEFT JOIN category c2
		on c1.categoryPid=c2.categoryId
		 where articleUserName=#{userName}
		 and a.articleUserName=u.userName
		 and a.articleChildCategoryId=c1.categoryId
		 and a.articleStatus=1
		 order by a.articlePostTime desc
		 limit #{index},#{pageSize}
	</select>
	
	<select id="selectArticleCount" resultType="java.lang.Integer">
		select count(1) from article where articleUserName=#{userName} and articleStatus=1
	</select>
	<select id="selectArticleViewCount" resultType="java.lang.Integer">
		select sum(articleViewCount) from article where articleUserName=#{userName} and articleStatus=1
	</select>
	<select id="selectArticleLikeCount" resultType="java.lang.Integer">
		select sum(articleLikeCount) from article where articleUserName=#{userName} and articleStatus=1
	</select>
	<select id="selectArticleCommentCount" resultType="java.lang.Integer">
		select sum(articleCommentCount) from article where articleUserName=#{userName} and articleStatus=1
	</select>
	<select id="selectArticleByCategoryId" resultType="Article">
		select a.*,u.userNickName,c1.categoryName  parentCategory,c2.categoryName childCategory 
		from article a,user u,category c1 LEFT JOIN category c2
		on c1.categoryid=c2.categoryPid
		 where articleUserName=#{userName}
		 and a.articleStatus=1
		 and a.articleUserName=u.userName
		 and (a.articleChildCategoryId=#{categoryId} or a.articleParentCategoryId=#{categoryId})
		 and (c2.categoryId=a.articleChildCategoryId or c2.categoryId=a.articleParentCategoryId)
		 order by a.articlePostTime desc
		 <!--  limit #{index},#{pageSize} -->
	</select>
	<delete id="delArticleById">
		delete from article
		where articleId=#{articleId}
	</delete>
	<!-- 修改文章分类 -->
	<update id="updateArticleCategoryById" parameterType="Article">
		update article set articleParentCategoryId=#{categoryId},articleChildCategoryId=#{categoryId}
		where articleId=#{articleId}
	</update>
	
</mapper>